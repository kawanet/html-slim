<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>html-slim browser demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="../dist/html-slim.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
    }

    .parent {
      display: flex;
      flex-direction: row;
      margin: 1rem;
      gap: 1rem;
    }

    textarea {
      width: 100%;
      height: 90vh;
      flex-grow: 1;
      flex-shrink: 1;
      line-height: 1.2;
    }

    #option {
      line-height: 1.6;
    }
  </style>
</head>
<body>
<div class="parent">
  <textarea id="source"></textarea>
  <textarea id="option"></textarea>
  <textarea id="result"></textarea>
</div>
<script>
  window.onload = async () => {
    const $source = document.querySelector("#source");
    const $option = document.querySelector("#option");
    const $result = document.querySelector("#result");

    const onChange = () => {
      try {
        const options = JSON.parse($option.value)
        $option.value = JSON.stringify(options, null, 2);
        if (options.tag) {
          options.tag = new RegExp(options.tag);
        }
        if (options.attr) {
          options.attr = new RegExp(options.attr);
        }
        $result.value = slim(options)($source.value)
      } catch (e) {
        $result.value = String(e)
      }
    }

    $source.addEventListener("change", onChange);
    $source.addEventListener("onkeyup", onChange);
    $option.addEventListener("change", onChange);

    const res = await fetch("sample.html");
    $source.value = await res.text();

    $option.value = JSON.stringify({
      selector: "body > header, body > footer",
      script: true,
      ldJson: false,
      style: true,
      space: true,
      tag: "^(next-|nextjs-)",
      attr: "^(data-v-)",
      comment: true,
    }, null, 2);

    setTimeout(onChange, 1);
  }
</script>
</body>
</html>
